<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>HAMT PASTRY - Admin Dashboard</title>
<style>
:root{
  --bg:#f5e6e0;--side:#e8d5c4;--side-b:#d7c0ad;
  --panel:#fff;--line:#ece2d9;--ink:#2a2a2a;--muted:#7a7066;
  --btn:#5c3d1f;--accent:#6a4b2f;--danger:#c93a3a;--green:#22c55e;--brown:#8b5a3c;
}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--ink);font:14px/1.5 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif}
.wrap{display:grid;grid-template-columns:206px 1fr;min-height:100vh}

/* Sidebar */
.side{background:var(--side);border-right:1px solid var(--side-b);padding:24px 0;position:sticky;top:0;height:100vh;overflow-y:auto}
.brand{font-weight:800;margin:0 20px 32px;font-size:15px;letter-spacing:0.5px;cursor:pointer;color:var(--ink)}
.nav{display:flex;flex-direction:column}
.nav a{display:flex;align-items:center;gap:12px;padding:14px 20px;color:#3d342b;text-decoration:none;font-size:14px;transition:background .15s;cursor:pointer}
.nav a:hover,.nav a.active{background:#d4c4b3;font-weight:500}
.ico{width:20px;height:20px}

/* Main */
.main{padding:24px 32px;max-width:1400px;margin:0 auto;width:100%}
.top{background:#f0e4db;border:1px solid #e5d5c6;border-radius:12px;padding:16px 24px;display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
.title{font-weight:800;letter-spacing:1px;font-size:15px}
.profile{display:flex;align-items:center;gap:12px}
.profile-text{text-align:right;font-size:13px}
.profile-text .name{font-weight:600}
.profile-text .role{font-size:11px;color:#7a7066}
.avatar{width:36px;height:36px;border-radius:50%;background:#c6ad96}
.hr{height:1px;background:#d7c0ad;margin:0 0 20px}

/* Button */
.bar{display:flex;justify-content:flex-end;margin:0 0 20px}
.btn{cursor:pointer;padding:11px 18px;border-radius:8px;border:none;background:var(--btn);color:#fff;font-weight:600;font-size:13px;transition:all .15s}
.btn:hover{background:#4a3118;transform:translateY(-1px)}
.btn:active{transform:scale(0.98)}
.btn-danger{background:var(--danger)}
.btn-danger:hover{background:#b02020}

/* Card */
.card{background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,.06);border:1px solid #f0e8e0}
.head,.row{display:grid;gap:20px;align-items:center;padding:16px 24px}
.head{color:#8b7f73;font-weight:600;font-size:13px;border-bottom:1px solid #f3ebe5;background:#fafafa}
.list .row{border-bottom:1px solid #f9f4f0;transition:background .15s}
.list .row:hover{background:#fdfbf9}
.list .row:last-child{border-bottom:none}

/* Product specific */
.product-grid{grid-template-columns:80px 1fr 120px 100px 180px}
.thumb{width:60px;height:60px;border-radius:8px;border:1px solid #eee;object-fit:cover;background:#f5f5f5}
.name{font-weight:500;font-size:14px;color:var(--ink)}
.center{text-align:center;font-size:14px}
.right{display:flex;gap:8px;justify-content:flex-end}
.chip{padding:7px 16px;border-radius:6px;background:#d4b899;color:#6f5439;font-weight:600;border:none;cursor:pointer;font-size:13px;transition:all .15s}
.chip:hover{background:#c9a87f;transform:translateY(-1px)}
.chip-danger{background:#f0cfcf;color:#8a2626}
.chip-danger:hover{background:#eab5b5}

/* Tabs */
.tabs{display:flex;gap:0;margin-bottom:24px}
.tab{padding:14px 36px;background:#d7c0ad;color:#3d342b;border:none;cursor:pointer;font-size:14px;font-weight:600;transition:all .15s;letter-spacing:0.3px}
.tab:first-child{border-radius:8px 0 0 8px}
.tab:last-child{border-radius:0 8px 8px 0}
.tab.active{background:var(--btn);color:#fff}
.tab:hover:not(.active){background:#cbb79e}

/* Stats */
.stats{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:24px}
.stat-card{background:#fff;border:2px solid #333;border-radius:12px;padding:24px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,.08)}
.stat-card h3{font-size:16px;color:var(--muted);margin-bottom:8px;font-weight:600}
.stat-card .num{font-size:36px;font-weight:700;color:var(--ink)}

/* Customer specific */
.customer-grid{grid-template-columns:100px 1fr 1fr 120px 100px}

/* Voucher specific */
.voucher-card{background:#fff;border-radius:12px;padding:24px 32px;margin-bottom:16px;box-shadow:0 2px 8px rgba(0,0,0,.08);border:1px solid #f0e8e0;display:flex;justify-content:space-between;align-items:center;transition:all .2s}
.voucher-card:hover{box-shadow:0 4px 12px rgba(0,0,0,.12);transform:translateY(-2px)}
.voucher-info{flex:1}
.voucher-code{font-weight:700;font-size:16px;color:var(--ink);margin-bottom:6px;letter-spacing:0.5px}
.voucher-desc{font-size:14px;color:var(--muted);line-height:1.6}
.voucher-counter{display:flex;align-items:center;gap:12px}
.counter-btn{width:32px;height:32px;border:2px solid #333;background:#fff;border-radius:6px;cursor:pointer;font-size:18px;font-weight:700;display:flex;align-items:center;justify-content:center;transition:all .15s}
.counter-btn:hover{background:#f5f5f5;transform:scale(1.05)}
.counter-btn:active{transform:scale(0.95)}
.counter-num{min-width:40px;text-align:center;font-size:16px;font-weight:600;color:var(--ink)}
.member-cards{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:24px}
.member-card{background:#fff;border:3px solid #2a2a2a;border-radius:12px;padding:28px;display:flex;align-items:center;gap:20px;box-shadow:0 2px 8px rgba(0,0,0,.08);transition:transform .2s}
.member-card:hover{transform:translateY(-2px)}
.member-icon{width:70px;height:70px;display:flex;align-items:center;justify-content:center;border-radius:50%;flex-shrink:0}
.member-icon.gold{background:#ffd700}
.member-icon.silver{background:#c0c0c0}
.member-icon.bronze{background:#cd7f32}
.member-info{flex:1}
.member-info h3{font-size:15px;color:var(--muted);margin-bottom:6px;font-weight:600;letter-spacing:0.3px}
.member-info .num{font-size:38px;font-weight:800;color:var(--ink);line-height:1}
.badge{display:inline-block;padding:6px 14px;border-radius:6px;font-size:12px;font-weight:600}
.badge.gold{background:#fef3c7;color:#92400e}
.badge.silver{background:#e5e7eb;color:#374151}
.badge.bronze{background:#fed7aa;color:#9a3412}

/* Order specific */
.order-grid{grid-template-columns:120px 1fr 200px 140px 120px}
.order-actions{display:flex;gap:8px;justify-content:flex-end}
.action-btn{padding:8px 16px;border-radius:6px;border:none;cursor:pointer;font-size:12px;font-weight:600;transition:all .15s}
.action-btn.edit{background:#e8d5c4;color:#3d342b}
.action-btn.edit:hover{background:#d7c0ad}
.action-btn.delete{background:#f0cfcf;color:#8a2626}
.action-btn.delete:hover{background:#eab5b5}
.feedback-grid{grid-template-columns:100px 1fr 2fr 100px}
.comment{font-size:13px;color:#555;line-height:1.4}
.status{display:inline-block;padding:6px 14px;border-radius:6px;font-size:12px;font-weight:600}
.status.shipped{background:#d4f4dd;color:#166534}
.status.delivered{background:#dbeafe;color:#1e40af}
.status.pending{background:#fef3c7;color:#92400e}
.status.new{background:#fed7aa;color:#9a3412}
.status.reviewed{background:#e5e7eb;color:#374151}

/* Analytics */
.filters{display:flex;gap:12px;justify-content:flex-end;margin-bottom:24px}
.filter-select{padding:10px 16px;border:1px solid #d7c0ad;border-radius:8px;background:#fff;font-size:14px;font-weight:500;cursor:pointer;min-width:140px}
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:20px;margin-bottom:24px}
.stat-box{background:#fff;border:1px solid #f0e8e0;border-radius:12px;padding:20px;box-shadow:0 2px 8px rgba(0,0,0,.06)}
.stat-box h3{font-size:13px;color:var(--muted);margin-bottom:8px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px}
.stat-box .value{font-size:28px;font-weight:800;color:var(--ink);margin-bottom:4px}
.stat-box .change{font-size:12px;font-weight:600;color:var(--green)}
.stat-box .change.negative{color:#ef4444}
.stat-box.highlight{border-left:4px solid var(--brown)}
.product-thumb{width:60px;height:60px;border-radius:8px;object-fit:cover;margin-top:8px}
.product-name{font-size:13px;font-weight:600;margin-top:8px;color:var(--ink)}
.charts-grid{display:grid;grid-template-columns:1.5fr 1fr;gap:20px;margin-bottom:24px}
.chart-card{background:#fff;border:1px solid #f0e8e0;border-radius:12px;padding:24px;box-shadow:0 2px 8px rgba(0,0,0,.06)}
.chart-card h3{font-size:15px;font-weight:700;margin-bottom:20px;color:var(--ink)}
.chart-canvas{width:100%;height:280px}
.bottom-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}
.donut-container{display:flex;align-items:center;gap:32px}
.donut-chart{position:relative;width:200px;height:200px}
.donut-legend{flex:1}
.legend-item{display:flex;align-items:center;gap:12px;margin-bottom:12px}
.legend-color{width:20px;height:20px;border-radius:4px}
.legend-color.returning{background:#8b5a3c}
.legend-color.new{background:#e8d5c4}
.legend-text{font-size:14px;font-weight:500}
.legend-percent{font-size:13px;color:var(--muted);margin-left:auto;font-weight:600}
.product-list{display:flex;flex-direction:column;gap:12px}
.product-item{display:flex;align-items:center;gap:12px}
.product-label{font-size:14px;flex:1;font-weight:500}
.product-bar{height:28px;background:var(--brown);border-radius:6px;display:flex;align-items:center;justify-content:center;color:#fff;font-size:12px;font-weight:700}
.membership-grid{display:grid;grid-template-columns:1fr 1.2fr;gap:20px}
.membership-stats{display:flex;flex-direction:column;gap:16px}
.mem-stat{display:flex;flex-direction:column;gap:4px}
.mem-stat label{font-size:12px;color:var(--muted);font-weight:600}
.mem-stat .value{font-size:24px;font-weight:800;color:var(--ink)}
.mem-stat .sub{font-size:13px;color:var(--muted)}
.bar-chart-container{position:relative}
.bar-chart{display:flex;align-items:flex-end;justify-content:space-between;height:180px;gap:4px}
.bar{flex:1;background:var(--brown);border-radius:4px 4px 0 0;position:relative;transition:all .2s}
.bar:hover{opacity:.8}
.bar-label{position:absolute;bottom:-24px;left:50%;transform:translateX(-50%);font-size:10px;color:var(--muted);font-weight:600}
/* Button */
.bar{display:flex;justify-content:flex-end;margin:0 0 20px;background:#f5f5f5;padding:16px 24px;border-radius:8px;border:1px solid #e8e8e8}
/* Modal */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:999;backdrop-filter:blur(2px)}
.modal.show{display:flex}
.sheet{width:520px;max-width:90vw;background:#fff;border-radius:14px;border:1px solid var(--line);padding:28px;box-shadow:0 12px 40px rgba(0,0,0,.25)}
.sheet h3{margin-bottom:20px;font-size:18px;color:var(--ink);font-weight:700}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.field{display:flex;flex-direction:column;gap:6px}
.field.full{grid-column:1/-1}
label{font-size:12px;color:var(--muted);font-weight:600;letter-spacing:0.3px}
input[type="text"],input[type="number"]{width:100%;padding:11px 14px;border:1px solid #e0d5c9;border-radius:8px;font-size:14px;transition:border .2s}
input:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px rgba(106,75,47,.1)}
input[type="file"]{width:100%;font-size:13px;padding:8px}
.preview{width:100%;max-height:200px;border-radius:8px;margin-top:8px;object-fit:cover;border:1px solid #e0d5c9;display:none}
.preview.show{display:block}
.actions{display:flex;gap:10px;justify-content:flex-end;margin-top:24px}
.ghost{background:#fff;color:var(--btn);border:2px solid var(--btn);padding:10px 20px;border-radius:8px;cursor:pointer;font-weight:600;font-size:13px;transition:all .15s}
.ghost:hover{background:#f9f7f5;transform:translateY(-1px)}

.empty{text-align:center;padding:60px 20px;color:var(--muted);font-size:15px}
.page{display:none}
.page.active{display:block}

@media(max-width:1200px){
  .wrap{grid-template-columns:1fr}
  .side{position:relative;height:auto}
  .member-cards{grid-template-columns:1fr}
  .stats{grid-template-columns:1fr}
  .stats-grid{grid-template-columns:repeat(2,1fr)}
  .charts-grid{grid-template-columns:1fr}
  .bottom-grid{grid-template-columns:1fr}
  .membership-grid{grid-template-columns:1fr}
}
</style>
</head>
<body>
<div class="wrap">
  <aside class="side">
    <div class="brand" onclick="goTo('product')">HAMT PASTRY</div>
    <nav class="nav">
      <a id="navProduct" class="active" onclick="goTo('product')">
        <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M3 7h18M5 7v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7"/>
        </svg>
        Product
      </a>
      <a id="navOrder" onclick="goTo('order')">
        <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M3 7h18M6 7v10h12V7"/>
        </svg>
        Order
      </a>
      <a id="navCustomer" onclick="goTo('customer')">
        <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <circle cx="12" cy="8" r="3"/>
          <path d="M4 20a8 8 0 0 1 16 0"/>
        </svg>
        Customer
      </a>
      <a id="navVoucher" onclick="goTo('voucher')">
        <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M7 7h10l2 4-7 7-7-7 2-4z"/>
        </svg>
        Voucher
      </a>
      <a id="navReports" onclick="goTo('reports')">
        <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M3 3v18h18M7 13l4 4 7-9"/>
        </svg>
        Reports and Analytics
      </a>
    </nav>
  </aside>

  <main class="main">
    <!-- PRODUCT PAGE -->
    <div id="productPage" class="page active">
      <div class="top">
        <div class="title">PRODUCT MANAGEMENT</div>
        <div class="profile">
          <div class="profile-text">
            <div class="name">HAMT PASTRY</div>
            <div class="role">Admin</div>
          </div>
          <div class="avatar"></div>
        </div>
      </div>
      <div class="hr"></div>

      <div class="bar">
        <button class="btn" id="btnAdd">+ Add Product</button>
      </div>

      <section class="card">
        <div class="head product-grid">
          <div></div><div>Product</div><div class="center">Price</div><div class="center">Stock</div><div class="right">Action</div>
        </div>
        <div id="productList" class="list"></div>
      </section>
    </div>

    <!-- ORDER PAGE -->
    <div id="orderPage" class="page">
      <div class="top">
        <div class="title">ORDER MANAGEMENT</div>
        <div class="profile">
          <div class="profile-text">
            <div class="name">HAMT PASTRY</div>
            <div class="role">Admin</div>
          </div>
          <div class="avatar"></div>
        </div>
      </div>
      <div class="hr"></div>
      <div class="tabs">
        <button class="tab active" onclick="showTab('order')">Order</button>
        <button class="tab" onclick="showTab('feedback')">Customer Feedback</button>
      </div>
      <div id="orderTab">
        <div class="bar">
          <button class="btn" id="btnAddOrder">+ Add Order</button>
        </div>
        <div class="card">
          <div class="head order-grid">
            <div>Order ID</div><div>Customer</div><div>Total</div><div>Status</div><div>Action</div>
          </div>
          <div class="list" id="orderList"></div>
        </div>
        <button class="btn-view" onclick="alert('View all orders')">View All Orders</button>
      </div>
      <div id="feedbackTab" style="display:none">
        <div class="stats">
          <div class="stat-card">
            <h3>Total Feedback</h3>
            <div class="num">320</div>
          </div>
          <div class="stat-card">
            <h3>New Comments</h3>
            <div class="num">25</div>
          </div>
          <div class="stat-card">
            <h3>Reviewed</h3>
            <div class="num">295</div>
          </div>
        </div>
        <div class="card">
          <div class="head feedback-grid">
            <div>Order ID</div><div>Customer</div><div>Comment</div><div>Status</div>
          </div>
          <div class="list" id="feedbackList"></div>
        </div>
        <button class="btn-view" onclick="alert('View all feedback')">View All Feedback</button>
      </div>
    </div>

    <!-- CUSTOMER PAGE -->
    <div id="customerPage" class="page">
      <div class="top">
        <div class="title">CUSTOMER MANAGEMENT</div>
        <div class="profile">
          <div class="profile-text">
            <div class="name">HAMT PASTRY</div>
            <div class="role">Admin</div>
          </div>
          <div class="avatar"></div>
        </div>
      </div>
      <div class="hr"></div>
      <div class="member-cards">
        <div class="member-card">
          <div class="member-icon gold">
            <svg width="42" height="42" viewBox="0 0 24 24" fill="#d4af37" stroke="none">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
          </div>
          <div class="member-info">
            <h3>Gold Members</h3>
            <div class="num" id="goldCount">0</div>
          </div>
        </div>
        <div class="member-card">
          <div class="member-icon silver">
            <svg width="42" height="42" viewBox="0 0 24 24" fill="#a8a8a8" stroke="none">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
          </div>
          <div class="member-info">
            <h3>Silver Members</h3>
            <div class="num" id="silverCount">0</div>
          </div>
        </div>
        <div class="member-card">
          <div class="member-icon bronze">
            <svg width="42" height="42" viewBox="0 0 24 24" fill="#8b4513" stroke="none">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
          </div>
          <div class="member-info">
            <h3>Bronze Members</h3>
            <div class="num" id="bronzeCount">0</div>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="head customer-grid">
          <div>Customer ID</div><div>Name</div><div>Email</div><div>Phone</div><div>Tier</div>
        </div>
        <div class="list" id="customerList"></div>
      </div>
      <button class="btn-view" onclick="alert('View all customers')">View All Customers</button>
    </div>

    <!-- VOUCHER PAGE -->
    <div id="voucherPage" class="page">
      <div class="top">
        <div class="title">VOUCHER MANAGEMENT</div>
        <div class="profile">
          <div class="profile-text">
            <div class="name">HAMT PASTRY</div>
            <div class="role">Admin</div>
          </div>
          <div class="avatar"></div>
        </div>
      </div>
      <div class="hr"></div>
      <div class="bar">
        <button class="btn" id="btnAddVoucher">+ Add Voucher</button>
      </div>
      <div id="voucherList"></div>
    </div>

    <!-- REPORTS PAGE -->
    <div id="reportsPage" class="page">
      <div class="top">
        <div class="title">REPORTS AND ANALYTICS</div>
        <div class="profile">
          <div class="profile-text">
            <div class="name">HAMT PASTRY</div>
            <div class="role">Admin</div>
          </div>
          <div class="avatar"></div>
        </div>
      </div>
      <div class="hr"></div>

      <div class="filters">
        <select class="filter-select">
          <option>This month</option>
          <option>Last month</option>
          <option>Last 3 months</option>
        </select>
        <select class="filter-select">
          <option>This year</option>
          <option>Last year</option>
          <option>All time</option>
        </select>
      </div>

      <div class="stats-grid">
        <div class="stat-box">
          <h3>Sales Revenue</h3>
          <div class="value" id="totalRevenue">đ 0</div>
          <div class="change" id="revenueChange">+0%</div>
        </div>
        <div class="stat-box highlight">
          <h3>Top Product</h3>
          <img id="topProductImg" src="" class="product-thumb" style="display:none">
          <div class="product-name" id="topProductName">-</div>
        </div>
        <div class="stat-box">
          <h3>Total Orders</h3>
          <div class="value" id="totalOrders">0</div>
        </div>
        <div class="stat-box">
          <h3>Total Customers</h3>
          <div class="value" id="totalCustomers">0</div>
        </div>
      </div>

      <div class="charts-grid">
        <div class="chart-card">
          <h3>Sale Revenue</h3>
          <canvas id="revenueChart" class="chart-canvas"></canvas>
        </div>
        <div class="chart-card">
          <h3>Top 5 Products</h3>
          <div class="product-list" id="topProductsList"></div>
        </div>
      </div>

      <div class="bottom-grid">
        <div class="chart-card">
          <h3>Customer Retention Rate</h3>
          <div class="donut-container">
            <div class="donut-chart">
              <canvas id="donutChart"></canvas>
            </div>
            <div class="donut-legend">
              <div class="legend-item">
                <div class="legend-color returning"></div>
                <span class="legend-text">Returning Customers</span>
                <span class="legend-percent" id="returningPercent">0%</span>
              </div>
              <div class="legend-item">
                <div class="legend-color new"></div>
                <span class="legend-text">New Customers</span>
                <span class="legend-percent" id="newPercent">0%</span>
              </div>
            </div>
          </div>
        </div>

        <div class="chart-card">
          <h3>Membership Report</h3>
          <div class="membership-grid">
            <div class="membership-stats">
              <div class="mem-stat">
                <label>Total Members</label>
                <div class="value" id="totalMembers">0</div>
              </div>
              <div class="mem-stat">
                <label>Best Selling</label>
                <div class="value" style="font-size:18px" id="bestProduct">-</div>
              </div>
              <div class="mem-stat">
                <label>Avg Order Value</label>
                <div class="value" id="avgOrder">đ 0</div>
              </div>
            </div>
            <div class="bar-chart-container">
              <div class="bar-chart" id="membershipBars"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- Modals -->
<div class="modal" id="modal">
  <div class="sheet">
    <h3 id="mTitle">Add Product</h3>
    <div class="grid">
      <div class="field full">
        <label>Product Name</label>
        <input id="mName" type="text" placeholder="Vd: Passion Mango Cheese">
      </div>
      <div class="field">
        <label>Price (VND)</label>
        <input id="mPrice" type="number" min="0" step="1000" value="625000">
      </div>
      <div class="field">
        <label>Stock</label>
        <input id="mStock" type="number" min="0" step="1" value="1">
      </div>
      <div class="field full">
        <label>Image</label>
        <input id="mFile" type="file" accept="image/*">
        <img id="mPreview" class="preview">
      </div>
    </div>
    <div class="actions">
      <button class="ghost" id="mCancel">Cancel</button>
      <button class="btn" id="mSave">Save</button>
    </div>
  </div>
</div>

<div class="modal" id="modalDelete">
  <div class="sheet" style="width:420px">
    <h3>Delete Product</h3>
    <p style="color:var(--muted);margin:0 0 20px;font-size:14px">Delete "<strong id="delName"></strong>"?</p>
    <div class="actions">
      <button class="ghost" id="delCancel">Cancel</button>
      <button class="btn btn-danger" id="delConfirm">Delete</button>
    </div>
  </div>
</div>

<div class="modal" id="modalVoucher">
  <div class="sheet">
    <h3 id="vTitle">Add Voucher</h3>
    <div class="grid">
      <div class="field full">
        <label>Voucher Code</label>
        <input id="vCode" type="text" placeholder="Vd: BRONZEBDAY" style="text-transform:uppercase">
      </div>
      <div class="field full">
        <label>Description</label>
        <input id="vDesc" type="text" placeholder="Vd: 10% OFF birthday cakes">
      </div>
      <div class="field">
        <label>Initial Quantity</label>
        <input id="vQty" type="number" min="0" step="1" value="10">
      </div>
    </div>
    <div class="actions">
      <button class="ghost" id="vCancel">Cancel</button>
      <button class="btn" id="vSave">Save</button>
    </div>
  </div>
</div>

<div class="modal" id="modalOrder">
  <div class="sheet" style="width:560px">
    <h3 id="oTitle">Add Order</h3>
    <div class="grid">
      <div class="field full">
        <label>Customer Name</label>
        <input id="oCustomer" type="text" placeholder="Vd: Trang Nguyen">
      </div>
      <div class="field">
        <label>Total (VND)</label>
        <input id="oTotal" type="number" min="0" step="1000" value="625000">
      </div>
      <div class="field">
        <label>Status</label>
        <select id="oStatus" style="width:100%;padding:11px 14px;border:1px solid #e0d5c9;border-radius:8px;font-size:14px;background:#fff">
          <option value="pending">Pending</option>
          <option value="shipped">Shipped</option>
          <option value="delivered">Delivered</option>
        </select>
      </div>
    </div>
    <div class="actions">
      <button class="ghost" id="oCancel">Cancel</button>
      <button class="btn" id="oSave">Save</button>
    </div>
  </div>
</div>

<script>
const $={
  productList:document.getElementById('productList'),
  orderList:document.getElementById('orderList'),
  feedbackList:document.getElementById('feedbackList'),
  customerList:document.getElementById('customerList'),
  voucherList:document.getElementById('voucherList'),
  modal:document.getElementById('modal'),
  modalDel:document.getElementById('modalDelete'),
  modalVoucher:document.getElementById('modalVoucher'),
  modalOrder:document.getElementById('modalOrder'),
  mTitle:document.getElementById('mTitle'),
  mName:document.getElementById('mName'),
  mPrice:document.getElementById('mPrice'),
  mStock:document.getElementById('mStock'),
  mFile:document.getElementById('mFile'),
  mPreview:document.getElementById('mPreview'),
  delName:document.getElementById('delName'),
  vTitle:document.getElementById('vTitle'),
  vCode:document.getElementById('vCode'),
  vDesc:document.getElementById('vDesc'),
  vQty:document.getElementById('vQty'),
  oTitle:document.getElementById('oTitle'),
  oCustomer:document.getElementById('oCustomer'),
  oTotal:document.getElementById('oTotal'),
  oStatus:document.getElementById('oStatus')
};

let products=[];
async function loadProducts() {
  try {
    // gọi backend: http://localhost:3000/api/products
    const res = await fetch('/api/products');
    const data = await res.json();

    // API server.js trả: { id, name, Price, Stock } => map lại cho frontend
    products = data.map(p => ({
      id: p.id,
      name: p.name,
      price: p.Price || p.price,   // tuỳ theo tên cột bạn trả ra
      stock: p.Stock || p.stock,
      image: null                  // tạm thời chưa có cột ảnh trong DB
    }));

    renderProducts();
  } catch (err) {
    console.error('Lỗi load products:', err);
    $.productList.innerHTML = '<div class="empty">Không tải được sản phẩm</div>';
  }
}
let orders=[];
async function loadOrders() {
  try {
    const res = await fetch('/api/orders');
    const data = await res.json();
    // server.js trả: { id, customerName, totalAmount, status }
    orders = data.map(o => ({
      id: o.id,
      customer: o.customerName,
      total: o.totalAmount,
      status: o.Status || o.status
    }));
    renderOrders();
  } catch (err) {
    console.error('Lỗi load orders:', err);
    $.orderList.innerHTML = '<div class="empty">Không tải được đơn hàng</div>';
  }
}
let customers = [];
async function loadCustomers() {
  try {
    const res = await fetch('/api/customers');
    const data = await res.json();
    // API trả: { id, Name, Email, Phone, Tier }
    customers = data.map(c => ({
      id: c.id,
      name: c.Name || c.name,
      email: c.Email || c.email,
      phone: c.Phone || c.phone,
      tier: c.Tier  || c.tier
    }));
    renderCustomers();
    updateMemberCounts();
  } catch (err) {
    console.error('Lỗi load customers:', err);
    $.customerList.innerHTML = '<div class="empty">Không tải được khách hàng</div>';
  }
}

let vouchers=[];
async function loadVouchers() {
  try {
    const res = await fetch('/api/vouchers');
    const data = await res.json();
    // API trả: { id, code, desc, quantity }
    vouchers = data;
    renderVouchers();
  } catch (err) {
    console.error('Lỗi load vouchers:', err);
    $.voucherList.innerHTML = '<div class="empty">Không tải được voucher</div>';
  }
}

let editId=null;
let editVoucherId=null;
let editOrderId=null;
let delId=null;
let imgUrl=null;
let currentPage='product';

const fmt=n=>Number(n||0).toLocaleString('vi-VN')+' ₫';

const feedbacks=[
  {id:1201,customer:'Trang Nguyen',comment:'The delivery was faster than I expected! The pastries arrived...',status:'new'},
  {id:1200,customer:'Hiep Giang',comment:'Customer support was very kind and helped me change my...',status:'new'},
  {id:1199,customer:'Tam Anh',comment:'The design of the birthday cake was gorgeous, but the cream...',status:'new'},
  {id:1198,customer:'Duy Phung',comment:'Delivery came super fast, love how fresh everything was!',status:'new'},
  {id:1197,customer:'Duc Anh',comment:'The new chocolate croissant is sooo good. Please keep it on...',status:'reviewed'},
  {id:1196,customer:'Viet Hung',comment:'Staff was super friendly when I picked up my order. Thanks guys',status:'reviewed'},
  {id:1195,customer:'Hai Anh',comment:'It would be nice if you could add more vegan options to the...',status:'reviewed'}
];

function goTo(page){
  currentPage=page;
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav a').forEach(n=>n.classList.remove('active'));
  
  const pages={
    product:['productPage','navProduct'],
    order:['orderPage','navOrder'],
    customer:['customerPage','navCustomer'],
    voucher:['voucherPage','navVoucher'],
    reports:['reportsPage','navReports']
  };
  
  if(pages[page]){
    document.getElementById(pages[page][0]).classList.add('active');
    document.getElementById(pages[page][1]).classList.add('active');
    if(page==='reports')renderAnalytics();
    if(page==='customer')updateMemberCounts();
  }
}

function renderProducts(){
  if(!products.length){
    $.productList.innerHTML='<div class="empty">No products available</div>';
    return;
  }
  $.productList.innerHTML=products.map(p=>`
    <div class="row product-grid">
      <div><img class="thumb" src="${p.image||'https://via.placeholder.com/200'}"></div>
      <div class="name">${p.name}</div>
      <div class="center">${fmt(p.price)}</div>
      <div class="center">${p.stock||0}</div>
      <div class="right">
        <button class="chip" onclick="editProduct(${p.id})">Edit</button>
        <button class="chip chip-danger" onclick="deleteProduct(${p.id})">Delete</button>
      </div>
    </div>
  `).join('');
}

document.getElementById('btnAdd').onclick=()=>{
  editId=null;imgUrl=null;
  $.mTitle.textContent='Add Product';
  $.mName.value='';$.mPrice.value='625000';$.mStock.value='1';$.mFile.value='';
  $.mPreview.classList.remove('show');
  $.modal.classList.add('show');
};

window.editProduct=id=>{
  const p=products.find(x=>x.id===id);
  if(!p)return;
  editId=id;imgUrl=p.image;
  $.mTitle.textContent='Edit Product';
  $.mName.value=p.name;$.mPrice.value=p.price;$.mStock.value=p.stock;$.mFile.value='';
  if(p.image){
    $.mPreview.src=p.image;
    $.mPreview.classList.add('show');
  }else{
    $.mPreview.classList.remove('show');
  }
  $.modal.classList.add('show');
};

document.getElementById('mCancel').onclick=()=>$.modal.classList.remove('show');
$.modal.onclick=e=>{if(e.target===$.modal)$.modal.classList.remove('show')};

$.mFile.onchange=e=>{
  const f=e.target.files[0];
  if(!f)return;
  if(f.size>5e6){alert('File quá lớn!');$.mFile.value='';return}
  const r=new FileReader();
  r.onload=ev=>{
    imgUrl=ev.target.result;
    $.mPreview.src=imgUrl;
    $.mPreview.classList.add('show');
  };
  r.readAsDataURL(f);
};

document.getElementById('mSave').onclick = async () => {
  const name  = $.mName.value.trim();
  const price = Number($.mPrice.value);
  const stock = Number($.mStock.value);

  if (!name) { alert('Vui lòng nhập tên!'); return; }
  if (price < 0 || stock < 0) { alert('Giá trị không hợp lệ!'); return; }

  const body = { name, price, stock };

  try {
    if (editId) {
      // UPDATE
      await fetch(`/api/products/${editId}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });
      alert('Đã cập nhật!');
    } else {
      // INSERT
      await fetch('/api/products', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });
      alert('Đã thêm mới!');
    }

    await loadProducts();              // load lại từ DB
    $.modal.classList.remove('show');
  } catch (err) {
    console.error(err);
    alert('Lưu sản phẩm thất bại!');
  }
};

window.deleteProduct=id=>{
  const p=products.find(x=>x.id===id);
  if(!p)return;
  delId=id;
  $.delName.textContent=p.name;
  $.modalDel.classList.add('show');
};

document.getElementById('delCancel').onclick=()=>$.modalDel.classList.remove('show');
$.modalDel.onclick=e=>{if(e.target===$.modalDel)$.modalDel.classList.remove('show')};

document.getElementById('delConfirm').onclick = async () => {
  try {
    await fetch(`/api/products/${delId}`, {
      method: 'DELETE'
    });
    await loadProducts();
    $.modalDel.classList.remove('show');
    alert('Đã xóa!');
  } catch (err) {
    console.error(err);
    alert('Xóa sản phẩm thất bại!');
  }
};

function renderOrders(){
  if(!orders.length){
    $.orderList.innerHTML='<div class="empty">No orders</div>';
    return;
  }
  $.orderList.innerHTML=orders.map(o=>`
    <div class="row order-grid">
      <div style="font-weight:600;color:var(--accent)">#${o.id}</div>
      <div style="font-weight:500">${o.customer}</div>
      <div>${fmt(o.total)}</div>
      <div><span class="status ${o.status}">${o.status.charAt(0).toUpperCase()+o.status.slice(1)}</span></div>
      <div></div>
    </div>
  `).join('');
}

function renderFeedbacks(){
  $.feedbackList.innerHTML=feedbacks.map(f=>`
    <div class="row feedback-grid">
      <div style="font-weight:600;color:var(--accent)">#${f.id}</div>
      <div style="font-weight:500">${f.customer}</div>
      <div class="comment">${f.comment}</div>
      <div><span class="status ${f.status}">${f.status.charAt(0).toUpperCase()+f.status.slice(1)}</span></div>
    </div>
  `).join('');
}

function showTab(tab){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  event.target.classList.add('active');
  if(tab==='order'){
    document.getElementById('orderTab').style.display='block';
    document.getElementById('feedbackTab').style.display='none';
  }else{
    document.getElementById('orderTab').style.display='none';
    document.getElementById('feedbackTab').style.display='block';
  }
}

function updateMemberCounts(){
  const gold=customers.filter(c=>c.tier==='Gold').length;
  const silver=customers.filter(c=>c.tier==='Silver').length;
  const bronze=customers.filter(c=>c.tier==='Bronze').length;
  document.getElementById('goldCount').textContent=gold;
  document.getElementById('silverCount').textContent=silver;
  document.getElementById('bronzeCount').textContent=bronze;
}

function renderCustomers(){
  if(!customers.length){
    $.customerList.innerHTML='<div class="empty">No customers</div>';
    return;
  }
  $.customerList.innerHTML=customers.map(c=>`
    <div class="row customer-grid">
      <div style="font-weight:600;color:var(--accent)">#${c.id}</div>
      <div style="font-weight:500">${c.name}</div>
      <div style="color:var(--muted);font-size:13px">${c.email}</div>
      <div>${c.phone}</div>
      <div>${c.tier?`<span class="badge ${c.tier.toLowerCase()}">${c.tier}</span>`:'<span style="color:var(--muted)">–</span>'}</div>
    </div>
  `).join('');
}

function saveVouchers(){
  localStorage.setItem('hamt_vouchers',JSON.stringify(vouchers));
}

function renderVouchers(){
  if(!vouchers.length){
    $.voucherList.innerHTML='<div class="empty">No vouchers</div>';
    return;
  }
  $.voucherList.innerHTML=vouchers.map(v=>`
    <div class="voucher-card">
      <div class="voucher-info">
        <div class="voucher-code">${v.code}</div>
        <div class="voucher-desc">${v.desc}</div>
      </div>
      <div class="voucher-counter">
        <button class="counter-btn" onclick="updateVoucherQty(${v.id},-1)">−</button>
        <div class="counter-num">${v.quantity}</div>
        <button class="counter-btn" onclick="updateVoucherQty(${v.id},1)">+</button>
      </div>
    </div>
  `).join('');
}

async function updateVoucherQty(id, delta) {
  const v = vouchers.find(x => x.id === id);
  if (!v) return;

  let newQty = v.quantity + delta;
  if (newQty < 0) newQty = 0;

  try {
    await fetch(`/api/vouchers/${id}/quantity`, {
      method: 'PATCH',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ quantity: newQty })
    });
    await loadVouchers();
  } catch (err) {
    console.error(err);
    alert('Cập nhật số lượng voucher thất bại!');
  }
}

document.getElementById('btnAddVoucher').onclick=()=>{
  editVoucherId=null;
  $.vTitle.textContent='Add Voucher';
  $.vCode.value='';$.vDesc.value='';$.vQty.value='10';
  $.modalVoucher.classList.add('show');
};

document.getElementById('vCancel').onclick=()=>$.modalVoucher.classList.remove('show');
$.modalVoucher.onclick=e=>{if(e.target===$.modalVoucher)$.modalVoucher.classList.remove('show')};

document.getElementById('vSave').onclick = async () => {
  const code = $.vCode.value.trim().toUpperCase();
  const desc = $.vDesc.value.trim();
  const qty  = Number($.vQty.value);

  if (!code || !desc) { alert('Vui lòng điền đầy đủ!'); return; }
  if (qty < 0) { alert('Số lượng không hợp lệ!'); return; }

  const body = { code, desc, quantity: qty };

  try {
    if (editVoucherId) {
      await fetch(`/api/vouchers/${editVoucherId}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });
      alert('Đã cập nhật!');
    } else {
      await fetch('/api/vouchers', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });
      alert('Đã thêm!');
    }

    await loadVouchers();
    $.modalVoucher.classList.remove('show');
  } catch (err) {
    console.error(err);
    alert('Lưu voucher thất bại!');
  }
};

document.getElementById('btnAddOrder').onclick=()=>{
  editOrderId=null;
  $.oTitle.textContent='Add Order';
  $.oCustomer.value='';$.oTotal.value='625000';$.oStatus.value='pending';
  $.modalOrder.classList.add('show');
};

document.getElementById('oCancel').onclick=()=>$.modalOrder.classList.remove('show');
$.modalOrder.onclick=e=>{if(e.target===$.modalOrder)$.modalOrder.classList.remove('show')};

document.getElementById('oSave').onclick = async () => {
  const customer = $.oCustomer.value.trim();
  const total    = Number($.oTotal.value);
  const status   = $.oStatus.value;

  if (!customer) { alert('Vui lòng nhập tên khách hàng!'); return; }
  if (total < 0) { alert('Giá trị không hợp lệ!'); return; }

  const body = {
    customerName: customer,
    totalAmount: total,
    status
  };

  try {
    if (editOrderId) {
      await fetch(`/api/orders/${editOrderId}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });
      alert('Đã cập nhật!');
    } else {
      await fetch('/api/orders', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });
      alert('Đã thêm!');
    }

    await loadOrders();
    $.modalOrder.classList.remove('show');
  } catch (err) {
    console.error(err);
    alert('Lưu order thất bại!');
  }
};

function renderAnalytics(){
  const totalRev=orders.reduce((sum,o)=>sum+o.total,0);
  document.getElementById('totalRevenue').textContent=fmt(totalRev);
  document.getElementById('revenueChange').textContent='+9.2% than last month';
  document.getElementById('totalOrders').textContent=orders.length;
  document.getElementById('totalCustomers').textContent=customers.length;
  
  if(products.length>0){
    const top=products[0];
    document.getElementById('topProductName').textContent=top.name;
    const img=document.getElementById('topProductImg');
    if(top.image){
      img.src=top.image;
      img.style.display='block';
    }
  }
  
  const productCounts={};
  products.forEach(p=>productCounts[p.name]=(productCounts[p.name]||0)+1);
  const sorted=Object.entries(productCounts).sort((a,b)=>b[1]-a[1]).slice(0,5);
  const total=sorted.reduce((s,x)=>s+x[1],0);
  
  document.getElementById('topProductsList').innerHTML=sorted.map(([name,count])=>{
    const pct=Math.round((count/total)*100);
    return`<div class="product-item">
      <div class="product-label">${name}</div>
      <div class="product-bar" style="width:${pct}%">${pct}%</div>
    </div>`;
  }).join('');
  
  const returning=Math.floor(customers.length*0.58);
  const newCust=customers.length-returning;
  const retPct=Math.round((returning/customers.length)*100);
  const newPct=100-retPct;
  document.getElementById('returningPercent').textContent=retPct+'%';
  document.getElementById('newPercent').textContent=newPct+'%';
  
  const memberTotal=customers.filter(c=>c.tier).length;
  document.getElementById('totalMembers').textContent=memberTotal;
  document.getElementById('bestProduct').textContent=products.length>0?products[0].name:'-';
  const avgOrder=orders.length>0?Math.round(totalRev/orders.length):0;
  document.getElementById('avgOrder').textContent=fmt(avgOrder);
  
  drawRevenueChart();
  drawDonutChart(retPct);
  drawMembershipBars();
}

function drawRevenueChart(){
  const canvas=document.getElementById('revenueChart');
  const ctx=canvas.getContext('2d');
  canvas.width=canvas.offsetWidth;
  canvas.height=canvas.offsetHeight;
  
  const months=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  const data=[20,25,22,30,35,38,42,48,70,55,48,45];
  const max=Math.max(...data);
  const pad=40;
  const w=canvas.width-pad*2;
  const h=canvas.height-pad*2;
  
  ctx.strokeStyle='#d7c0ad';
  ctx.lineWidth=1;
  ctx.beginPath();
  ctx.moveTo(pad,pad);
  ctx.lineTo(pad,canvas.height-pad);
  ctx.lineTo(canvas.width-pad,canvas.height-pad);
  ctx.stroke();
  
  ctx.fillStyle='#7a7066';
  ctx.font='11px sans-serif';
  ctx.textAlign='right';
  for(let i=0;i<=4;i++){
    const y=pad+(h/4)*i;
    const val=Math.round(max-(max/4)*i);
    ctx.fillText(val,pad-8,y+4);
  }
  
  ctx.textAlign='center';
  months.forEach((m,i)=>{
    const x=pad+(w/(months.length-1))*i;
    ctx.fillText(m,x,canvas.height-pad+20);
  });
  
  ctx.strokeStyle='#8b5a3c';
  ctx.lineWidth=2.5;
  ctx.beginPath();
  data.forEach((val,i)=>{
    const x=pad+(w/(data.length-1))*i;
    const y=canvas.height-pad-(val/max)*h;
    if(i===0)ctx.moveTo(x,y);
    else ctx.lineTo(x,y);
  });
  ctx.stroke();
  
  ctx.fillStyle='#8b5a3c';
  data.forEach((val,i)=>{
    const x=pad+(w/(data.length-1))*i;
    const y=canvas.height-pad-(val/max)*h;
    ctx.beginPath();
    ctx.arc(x,y,4,0,Math.PI*2);
    ctx.fill();
  });
}

function drawDonutChart(retPct){
  const canvas=document.getElementById('donutChart');
  const ctx=canvas.getContext('2d');
  canvas.width=200;
  canvas.height=200;
  
  const cx=100,cy=100,r=80,ir=50;
  const retAngle=(retPct/100)*Math.PI*2;
  
  ctx.fillStyle='#8b5a3c';
  ctx.beginPath();
  ctx.arc(cx,cy,r,0,retAngle);
  ctx.arc(cx,cy,ir,retAngle,0,true);
  ctx.fill();
  
  ctx.fillStyle='#e8d5c4';
  ctx.beginPath();
  ctx.arc(cx,cy,r,retAngle,Math.PI*2);
  ctx.arc(cx,cy,ir,Math.PI*2,retAngle,true);
  ctx.fill();
  
  ctx.fillStyle='#2a2a2a';
  ctx.font='bold 24px sans-serif';
  ctx.textAlign='center';
  ctx.textBaseline='middle';
  ctx.fillText(retPct+'%',cx,cy);
}

function drawMembershipBars(){
  const data=[25,28,30,32,35,38,42,45,48,52,55,58];
  const months=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  const max=Math.max(...data);
  const container=document.getElementById('membershipBars');
  container.innerHTML='';
  
  data.forEach((val,i)=>{
    const bar=document.createElement('div');
    bar.className='bar';
    bar.style.height=`${(val/max)*100}%`;
    
    const label=document.createElement('div');
    label.className='bar-label';
    label.textContent=months[i];
    
    bar.appendChild(label);
    container.appendChild(bar);
  });
}

(async () => {
  await loadProducts();
  await loadOrders();
  await loadVouchers();
  await loadCustomers();

  renderFeedbacks();  // vẫn dùng data mẫu tạm thời
})();
</script>
</body>
</html>
